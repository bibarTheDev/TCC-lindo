var formPesquisa=document.querySelector(".envolve-menu-canvas"),selectAno=document.querySelector("#select-ano"),selectMes=document.querySelector("#select-mes"),id_paciente=sessionStorage.getItem("id_paciente"),fiAnual=document.querySelector("#fi-anual"),fiMensal=document.querySelector("#fi-mensal"),fiSemanal=document.querySelector("#fi-semanal"),fGrafico=document.querySelector("#f-grafico"),fIntervalo=document.querySelector("#f-intervalo"),fgAlimentacaoGrafico=document.querySelector("#fg-alimentacao"),fgCriseGrafico_1=document.querySelector("#fg-crise_1"),fgCriseGrafico_2=document.querySelector("#fg-crise_2"),fgSonoGrafico_1=document.querySelector("#fg-sono_1"),fgSonoGrafico_2=document.querySelector("#fg-sono_2"),fgLazerGrafico=document.querySelector("#fg-lazer"),lblSelectAno=document.querySelector("#label-select-ano"),lblFiSemana=document.querySelector("#label-fi-semana"),lblSelectMes=document.querySelector("#label-select-mes"),filtro=document.querySelector("#f-filtros"),tituloGrafico=document.querySelector(".canvas-grafico > header > h3"),btnPesquisa=document.querySelector("#btn-pesquisa"),btnSair=document.querySelector("#btn-sair"),btnHelpGrafico=document.querySelector(".btn-help-grafico"),btnHelp=document.querySelector("#btn-help"),btnObservacao=document.querySelector("#btn-observacao"),grafico=null;async function DesativarVinculo(){let e={id_sessao:sessionStorage.getItem("id_sessao")},t=await this.Ajax(e,13);t.sucess?((new window_mud).Alert("ATENÇÃO",t.msg,"Exclusão do vínculo","fas fa-times","w-p-default",!1,""),window.location.href="./"):(new window_mud).Alert("ATENÇÃO",t.msg,"Exclusão do vínculo","fas fa-times","w-p-default",!1,"")}function MontarExtras(e){let t=document.createElement("p"),a=document.createElement("div"),o=document.createElement("p"),r=document.createElement("p"),n=document.createElement("p"),s=document.createElement("p"),i=document.createElement("p"),c=document.createElement("p");semanaString=[];for(let l in e){const d=e[l];0==l&&(document.querySelector(".observacoes-section").textContent=""),"alimentacao"==fGrafico.getAttribute("data-grafico")||"sono1"==fGrafico.getAttribute("data-grafico")||"sono2"==fGrafico.getAttribute("data-grafico")||"lazer"==fGrafico.getAttribute("data-grafico")?(t.textContent=d.observacao,semanaString=d.semanaa.split(" "),this.CriarElementObservecao(semanaString[0],".observacoes-section",t)):"crise1"!=fGrafico.getAttribute("data-grafico")&&"crise2"!=fGrafico.getAttribute("data-grafico")||(a.appendChild(o),a.appendChild(s),a.appendChild(r),a.appendChild(i),a.appendChild(n),a.appendChild(c),a.setAttribute("class","extra-crise"),o.textContent="local",r.textContent="situacao",n.textContent="acompanhado",s.textContent=d.local,i.textContent=d.situacao,c.textContent=d.acompanhado,semanaString=d.semanaa.split(" "),this.CriarElementObservecao(semanaString[0],".observacoes-section",a))}}function CriarSectionObservacao(e,t){if(0==document.querySelectorAll(".observacoes").length){let a=document.querySelector(e),o=document.createElement("section"),r=document.createElement("header"),n=document.createElement("h3"),s=document.createElement("section");r.appendChild(n),o.appendChild(r),o.appendChild(s),o.setAttribute("class","observacoes"),s.setAttribute("class","observacoes-section"),n.textContent=t,a.appendChild(o)}}function CriarElementObservecao(e,t,a){let o=document.createElement("section"),r=document.createElement("header"),n=document.createElement("h4"),s=document.createElement("section");o.setAttribute("class","observacoes-element"),o.appendChild(r),o.appendChild(s),r.appendChild(n),s.appendChild(a),n.textContent=e,document.querySelector(t).appendChild(o)}async function BuscarDados(e){try{let t={grafico:fGrafico.getAttribute("data-grafico"),paciente:id_paciente,intervalo:fIntervalo.getAttribute("data-periodo"),ano:selectAno.getAttribute("data-select"),mes:this.CorresponderMes(selectMes.value)};return comando="grafico"==e?11:"observacao-extra"==e?12:"lazer-extra"==e?13:0,dados=await this.Ajax(t,comando),dados.sucess?dados.grafico:dados.erro}catch(e){console.log(e)}}function MontarDadosGraficoLazer(e,t){let a,o=[],r=[];const n=new Object(e);switch(t){case"meses":o=[0,0,0,0,0,0,0,0,0,0,0,0];for(let e in n){const t=n[e];for(let e in t){const a=t[e];for(let e in a)Number.isNaN(a[e])||(o[a.meses-1]=parseInt(a.num_atividade,10))}}r=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];break;case"ano":r=[];for(let e in n){const t=n[e];for(let e in t){const a=t[e];o.push(parseInt(a.num_atividade,10)),r.push(e)}}}return a={valores:{num_atividade:{nome:"N° de atividades realizadas",data:o,borderColor:"rgb(44,214,198)",backgroundColor:"rgb(0,0,0,0)"}},returnPeriodo:r}}function MontarDadosGraficoSono2(e,t){let a,o,r=[];const n=new Object(e);switch(t){case"meses":a=[0,0,0,0,0,0,0,0,0,0,0,0];for(let e in n){const t=n[e];for(let e in t){const o=t[e];for(let e in o)Number.isNaN(o[e])||(a[o.meses-1]=parseInt(o.duracao_sono,10))}}r=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];break;case"semana":case"ano":a=[];for(let e in n){const t=n[e];for(let e in t){const o=t[e];a.push(parseInt(o.duracao_sono,10)),r.push(e)}}}return o={valores:{duracao_sono:{nome:"Tempo dormido",data:a,borderColor:"rgb(44,214,198)",backgroundColor:"rgb(0,0,0,0)"}},returnPeriodo:r}}function MontarDadosGraficoSono1(e,t){let a,o,r=[];const n=new Object(e);switch(t){case"meses":a=[0,0,0,0,0,0,0,0,0,0,0,0];for(let e in n){const t=n[e];for(let e in t){const o=t[e];for(let e in o)Number.isNaN(o[e])||(a[o.meses-1]=parseInt(o.num_acordou,10))}}r=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];break;case"semana":case"ano":a=[];for(let e in n){const t=n[e];for(let e in t){const o=t[e];a.push(parseInt(o.num_acordou,10)),r.push(e)}}}return o={valores:{acordou:{nome:"Nº que acordou durante a noite",data:a,borderColor:"rgb(44,214,198)",backgroundColor:"rgb(0,0,0,0)"}},returnPeriodo:r}}function VerificarIntensidade(e){return e>=0&&e<1?0:e>=1&&e<3?2:e>=3&&e<5?4:e>=5&&e<=6?6:void 0}function MontarDadosGraficoCrise1(e,t){console.log(e);let a,o,r,n,s,i,c,l,d,u,f=[],b=[];const m=new Object(e);switch(t){case"meses":o=[0,0,0,0,0,0,0,0,0,0,0,0],r=[0,0,0,0,0,0,0,0,0,0,0,0],n=[0,0,0,0,0,0,0,0,0,0,0,0],s=[0,0,0,0,0,0,0,0,0,0,0,0];for(let e in m){const t=m[e];for(let e in t){const i=t[e];for(let e in i)if(!Number.isNaN(i[e]))switch(a=this.VerificarIntensidade(i.intensidade)){case 0:o[i.meses-1]=parseInt(i.duracao,10);break;case 2:r[i.meses-1]=parseInt(i.duracao,10);break;case 4:n[i.meses-1]=parseInt(i.duracao,10);break;case 6:s[i.meses-1]=parseInt(i.duracao,10)}}}b=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];break;case"ano":o=[],r=[],n=[],s=[],b=[];for(let e in m){const t=m[e];for(let e in t){const i=t[e];switch(a=this.VerificarIntensidade(i.intensidade)){case 0:o.push(parseInt(i.duracao,10));break;case 2:r.push(parseInt(i.duracao,10));break;case 4:n.push(parseInt(i.duracao,10));break;case 6:s.push(parseInt(i.duracao,10))}b.push(e)}}}return u={valores:f=[i={label:"leve",data:o,borderColor:"rgb(44,214,198)",backgroundColor:"rgb(44,214,198)",fill:!0,borderWidth:1},c={label:"moderado",data:r,borderColor:"rgb(0,189,255)",backgroundColor:"rgb(0,189,255)",fill:!0,borderWidth:1},l={label:"forte",data:n,borderColor:"rgb(0,255,218)",backgroundColor:"rgb(0,255,218)",fill:!0,borderWidth:1},d={label:"extremo",data:s,borderColor:"rgb(14,237,118)",backgroundColor:"rgb(14,237,118)",fill:!0,borderWidth:1}],returnPeriodo:b}}function MontarDadosGraficoCrise2(e,t){let a,o=[],r=[];const n=new Object(e);switch(t){case"meses":o=[0,0,0,0,0,0,0,0,0,0,0,0];for(let e in n){const t=n[e];for(let e in t){const a=t[e];for(let e in a)Number.isNaN(a[e])||(o[a.meses-1]=parseInt(a.num_crises,10))}}r=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];break;case"ano":r=[];for(let e in n){const t=n[e];for(let e in t){const a=t[e];o.push(parseInt(a.num_crises,10)),r.push(e)}}}return a={valores:{crise:{nome:"N° de crises",data:o,borderColor:"rgb(44,214,198)",backgroundColor:"rgb(0,0,0,0)"}},returnPeriodo:r}}function MontarDadosGraficoAlimentacao(e,t){let a,o,r,n,s,i,c,l,d,u,f=[];const b=new Object(e);switch(t){case"meses":a=[0,0,0,0,0,0,0,0,0,0,0,0],o=[0,0,0,0,0,0,0,0,0,0,0,0],r=[0,0,0,0,0,0,0,0,0,0,0,0],n=[0,0,0,0,0,0,0,0,0,0,0,0],s=[0,0,0,0,0,0,0,0,0,0,0,0],i=[0,0,0,0,0,0,0,0,0,0,0,0],c=[0,0,0,0,0,0,0,0,0,0,0,0],l=[0,0,0,0,0,0,0,0,0,0,0,0],d=[0,0,0,0,0,0,0,0,0,0,0,0];for(let e in b){const t=b[e];for(let e in t){const u=t[e];for(let e in u)Number.isNaN(u[e])||(a[u.meses-1]=parseInt(u.carboidratos,10),s[u.meses-1]=parseInt(u.hidratacao,10),r[u.meses-1]=parseInt(u.laticinios,10),o[u.meses-1]=parseInt(u.proteinas,10),n[u.meses-1]=parseInt(u.verd_frut,10),i[u.meses-1]=parseInt(u.vezes_acordou,10),c[u.meses-1]=parseInt(u.tempo,10),l[u.meses-1]=parseInt(u.intensidade,10),d[u.meses-1]=parseInt(u.vezes,10))}}f=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];break;case"semana":case"ano":a=[],o=[],r=[],n=[],s=[],i=[],c=[],l=[],d=[];for(let e in b){const t=b[e];for(let e in t){const u=t[e];a.push(parseInt(u.carboidratos,10)),s.push(parseInt(u.hidratacao,10)),r.push(parseInt(u.laticinios,10)),o.push(parseInt(u.proteinas,10)),n.push(parseInt(u.verd_frut,10)),i.push(parseInt(u.vezes_acordou,10)),c.push(parseInt(u.tempo,10)),l.push(parseInt(u.intensidade,10)),d.push(parseInt(u.vezes,10)),f.push(e)}}}return u={valores:{carboidratos:{nome:"CARBOIDRATOS",data:a,borderColor:"rgb(44,214,198)",backgroundColor:"rgb(0,0,0,0)"},proteinas:{nome:"PROTEÍNAS",data:o,borderColor:"rgb(0,189,255)",backgroundColor:"rgb(0,0,0,0)"},laticinios:{nome:"LATICÍNIOS",data:r,borderColor:"rgb(0,255,218)",backgroundColor:"rgb(0,0,0,0)"},verd_frut:{nome:"VERDURAS E FRUTAS",data:n,borderColor:"rgb(14,237,137)",backgroundColor:"rgb(0,0,0,0)"},hidratacao:{nome:"HIDRATAÇÃO",data:s,borderColor:"#0070ff",backgroundColor:"rgb(0,0,0,0)"},vezes_acordou:{nome:"VEZES QUE ACORDOU",data:i,borderColor:"#3dc88d",backgroundColor:"rgb(0,0,0,0)"},tempo:{nome:"TEMPO",data:c,borderColor:"#165044",backgroundColor:"rgb(0,0,0,0)"},intensidade:{nome:"INTENSIDADE",data:l,borderColor:"rgb(42,202,41)",backgroundColor:"rgb(0,0,0,0)"},vezes:{nome:"VEZES",data:d,borderColor:"rgb(68,141,218)",backgroundColor:"rgb(0,0,0,0)"}},returnPeriodo:f}}function CriarOption(e,t){let a=document.createElement("option");a.value=t,a.textContent=t,e.add(a)}function CorresponderMes(e){let t;switch(e){case"janeiro":t=1;break;case"fevereiro":t=2;break;case"março":t=3;break;case"abril":t=4;break;case"maio":t=5;break;case"junho":t=6;break;case"julho":t=7;break;case"agosto":t=8;break;case"setembro":t=9;break;case"outubro":t=10;break;case"novembro":t=11;break;case"dezembro":t=12}return t}async function RetornarAnoDisponiveisTabela(e,t){let a={tabela:e,paciente:t},o=await this.Ajax(a,9),r=[];for(let e in o.anos){const t=o.anos[e];for(let e in t)r.push(t[e])}return r}async function RetornarMesDisponiveisTabela(e,t,a){try{let o={tabela:e,paciente:t,ano:a},r=await this.Ajax(o,10),n=[];for(let e in r)n.push(r[e]);return n}catch(e){console.error(e)}}async function MontarSelect(e,t){let a,o=selectAno.getAttribute("data-select");switch(t.getAttribute("data-tipo")){case"ano":a=await this.RetornarAnoDisponiveisTabela(e,id_paciente);break;case"mes":a=await this.RetornarMesDisponiveisTabela(e,id_paciente,o)}let r=t.length;if(t.length>0)for(let e=0;e<r;e++)t.remove(0);for(let e in a)this.CriarOption(t,a[e])}function VetorDataSets(e,t){let a=[];for(let o in e.valores)valoresObj=e.valores[o],a.push({label:valoresObj.nome,data:valoresObj.data,borderColor:valoresObj.borderColor,backgroundColor:valoresObj.backgroundColor,borderWidth:t});return a}function Gambiarra(){}function GerarGrafico(e,t,a,o){console.log(t),null==grafico?grafico=new Chart(document.querySelector(o),{type:e,data:{labels:a,datasets:t}}):(grafico.options="bar"==e?{scales:{xAxes:[{stacked:!0}],yAxes:[{stacked:!0,scaleLabel:{display:!0,labelString:"duração da crise(segundos)"}}]}}:{scales:{xAxes:[{stacked:!1}],yAxes:[{stacked:!1}]}},grafico.config.type=e,grafico.data.labels=a,grafico.data.datasets=t,grafico.update())}selectAno.addEventListener("change",e=>{let t=e.target.value;selectAno.setAttribute("data-select",t),this.MontarSelect("semana",selectMes)}),selectMes.addEventListener("change",e=>{let t=e.target.value;console.log(t),selectMes.setAttribute("data-select",t)}),window.addEventListener("load",()=>{this.MontarSelect("semana",selectAno),this.MontarSelect("semana",selectMes),lblSelectMes.style.display="none"}),formPesquisa.addEventListener("submit",e=>{e.preventDefault()}),fiAnual.addEventListener("change",()=>{filtro.style.display="none",selectAno.setAttribute("data-select","todos"),fIntervalo.setAttribute("data-periodo",fiAnual.value)}),fiMensal.addEventListener("change",()=>{lblSelectMes.style.display="none",filtro.style.display="grid",selectAno.setAttribute("data-select",selectAno.value),fIntervalo.setAttribute("data-periodo",fiMensal.value)}),fiSemanal.addEventListener("change",()=>{lblSelectMes.style.display="inline-flex",filtro.style.display="grid",selectAno.setAttribute("data-select",selectAno.value),fIntervalo.setAttribute("data-periodo",fiSemanal.value)}),fgAlimentacaoGrafico.addEventListener("change",()=>{fGrafico.setAttribute("data-grafico",fgAlimentacaoGrafico.value),lblFiSemana.style.display="inline-flex"}),fgLazerGrafico.addEventListener("change",()=>{fGrafico.setAttribute("data-grafico",fgLazerGrafico.value),lblFiSemana.style.display="none"}),fgCriseGrafico_1.addEventListener("change",()=>{fGrafico.setAttribute("data-grafico",fgCriseGrafico_1.value),lblFiSemana.style.display="none"}),fgCriseGrafico_2.addEventListener("change",()=>{fGrafico.setAttribute("data-grafico",fgCriseGrafico_2.value),lblFiSemana.style.display="none"}),fgSonoGrafico_1.addEventListener("change",()=>{fGrafico.setAttribute("data-grafico",fgSonoGrafico_1.value),lblFiSemana.style.display="inline-flex"}),fgSonoGrafico_2.addEventListener("change",()=>{fGrafico.setAttribute("data-grafico",fgSonoGrafico_2.value),lblFiSemana.style.display="inline-flex"}),btnPesquisa.addEventListener("click",async e=>{let t,a,o=await this.BuscarDados("grafico");switch(fGrafico.getAttribute("data-grafico")){case"alimentacao":t=this.MontarDadosGraficoAlimentacao(o,fIntervalo.getAttribute("data-periodo")),a=this.VetorDataSets(t,3),this.GerarGrafico("line",a,t.returnPeriodo,"#canvas"),tituloGrafico.textContent="ALIMENTAÇÃO";break;case"crise1":t=this.MontarDadosGraficoCrise1(o,fIntervalo.getAttribute("data-periodo")),this.GerarGrafico("bar",t.valores,t.returnPeriodo,"#canvas"),tituloGrafico.textContent="CRISE 1";break;case"crise2":t=this.MontarDadosGraficoCrise2(o,fIntervalo.getAttribute("data-periodo")),a=this.VetorDataSets(t,3),this.GerarGrafico("line",a,t.returnPeriodo,"#canvas"),tituloGrafico.textContent="CRISE 2";break;case"sono1":t=this.MontarDadosGraficoSono1(o,fIntervalo.getAttribute("data-periodo")),a=this.VetorDataSets(t,3),this.GerarGrafico("line",a,t.returnPeriodo,"#canvas"),tituloGrafico.textContent="SONO 1";break;case"sono2":t=this.MontarDadosGraficoSono2(o,fIntervalo.getAttribute("data-periodo")),a=this.VetorDataSets(t,3),this.GerarGrafico("line",a,t.returnPeriodo,"#canvas"),tituloGrafico.textContent="SONO 2";break;case"lazer":t=this.MontarDadosGraficoLazer(o,fIntervalo.getAttribute("data-periodo")),a=this.VetorDataSets(t,3),this.GerarGrafico("line",a,t.returnPeriodo,"#canvas"),tituloGrafico.textContent="LAZER"}}),btnHelpGrafico.addEventListener("click",()=>{let e=document.createElement("p");switch(e.setAttribute("class","b-h-g-p-help"),fGrafico.getAttribute("data-grafico")){case"alimentacao":e.textContent="Esse gráfico retorna informações referente a alimentação do seu paciente. No caso, não em valores nutricionais, mas se foi consumido um alimento do tipo que predomina carboidratos, protéínas ou semelhante";break;case"sono1":e.textContent="Esse gráfico retorna informações referente ao sono do seu paciente. No caso, ele retorna nº vezes que uma pessoa acordou DURANTE A NOITE.";break;case"sono2":e.textContent="Esse gráfico retorna informações referente ao sono do seu paciente. No caso, ele retorna a média do tempo dormido no intervalo estabelecido.";break;case"crise1":e.textContent="Esse gráfico retorna informações referente as crises do seu paciente. No caso, ele retorna a média da duração das crises no intervalo estabelecido. Ele identifica a intensidade dessa crises através das cores.";break;case"crise2":e.textContent="Esse gráfico retorna informações referente as crises do seu paciente. No caso, ele retorna a média do n° de crises no intervalo estabelecido.";break;case"lazer":e.textContent="Esse gráfico retorna informações referente as atividades físicas do seu paciente. No caso, ele retorna a média do n° de atividades realizadas no intervalo estabelecido."}(new window_mud).Modal("HELP",e,2,"w-p-default",!1,"")}),btnObservacao.addEventListener("click",async()=>{let e=await this.BuscarDados("observacao-extra");this.CriarSectionObservacao(".envolve-extras","OBSERVAÇÃO"),this.MontarExtras(e),console.log(e)}),btnSair.addEventListener("click",()=>{(new window_mud).Confirm("ATENÇÃO","Deseja excluir esse vínculo?","Exclusão","fas fa-times","w-p-default",this.DesativarVinculo,this.Gambiarra)}),btnHelp.addEventListener("click",()=>{(new window_mud).Alert("HELP","Página de gráficos","Gráficos","fas fa-question","w-p-default",!1,"")});